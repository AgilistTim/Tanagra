import{S as me,i as ve,s as pe,k as y,a as P,q as H,l as I,m as C,h as w,c as A,r as F,J as ne,n as p,b as ge,G as h,u as ie,H as le,y as U,z as X,A as Z,K as he,L as oe,M as Ee,g as D,f as ee,d as M,B as z,N as Se,O as ye,v as te,w as Ie}from"../chunks/index.2ee51f7d.js";function we(n){let s,a,t,e,r,i,g,S,m=n[0]==="user"?"Me":"Darmok",o,k,L,x,E,T;return{c(){s=y("div"),a=y("div"),t=y("div"),e=y("img"),g=P(),S=y("div"),o=H(m),k=P(),L=y("div"),x=H(n[1]),this.h()},l(c){s=I(c,"DIV",{class:!0});var v=C(s);a=I(v,"DIV",{class:!0});var N=C(a);t=I(N,"DIV",{class:!0});var O=C(t);e=I(O,"IMG",{src:!0,alt:!0}),O.forEach(w),N.forEach(w),g=A(v),S=I(v,"DIV",{class:!0});var $=C(S);o=F($,m),$.forEach(w),k=A(v),L=I(v,"DIV",{class:!0});var R=C(L);x=F(R,n[1]),R.forEach(w),v.forEach(w),this.h()},h(){ne(e.src,r="https://ui-avatars.com/api/?name="+(n[0]==="user"?"Me":"D"))||p(e,"src",r),p(e,"alt",i=n[0]+" avatar"),p(t,"class","w-10 rounded-full"),p(a,"class","chat-image avatar"),p(S,"class","chat-header"),p(L,"class",E="chat-bubble "+(n[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary")),p(s,"class",T="chat "+(n[0]==="user"?"chat-end":"chat-start")+" justify-end")},m(c,v){ge(c,s,v),h(s,a),h(a,t),h(t,e),h(s,g),h(s,S),h(S,o),h(s,k),h(s,L),h(L,x)},p(c,[v]){v&1&&!ne(e.src,r="https://ui-avatars.com/api/?name="+(c[0]==="user"?"Me":"D"))&&p(e,"src",r),v&1&&i!==(i=c[0]+" avatar")&&p(e,"alt",i),v&1&&m!==(m=c[0]==="user"?"Me":"Darmok")&&ie(o,m),v&2&&ie(x,c[1]),v&1&&E!==(E="chat-bubble "+(c[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary"))&&p(L,"class",E),v&1&&T!==(T="chat "+(c[0]==="user"?"chat-end":"chat-start")+" justify-end")&&p(s,"class",T)},i:le,o:le,d(c){c&&w(s)}}}function Ce(n,s,a){let{type:t}=s,{message:e}=s;return n.$$set=r=>{"type"in r&&a(0,t=r.type),"message"in r&&a(1,e=r.message)},[t,e]}class K extends me{constructor(s){super(),ve(this,s,Ce,we,pe,{type:0,message:1})}}var _e={};(function(n){var s=function(a,t){if(!(this instanceof s))return new s(a,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=a,t=t||{},this.headers=t.headers||{},this.payload=t.payload!==void 0?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,r){this.listeners[e]===void 0&&(this.listeners[e]=[]),this.listeners[e].indexOf(r)===-1&&this.listeners[e].push(r)},this.removeEventListener=function(e,r){if(this.listeners[e]!==void 0){var i=[];this.listeners[e].forEach(function(g){g!==r&&i.push(g)}),i.length===0?delete this.listeners[e]:this.listeners[e]=i}},this.dispatchEvent=function(e){if(!e)return!0;e.source=this;var r="on"+e.type;return this.hasOwnProperty(r)&&(this[r].call(this,e),e.defaultPrevented)?!1:this.listeners[e.type]?this.listeners[e.type].every(function(i){return i(e),!e.defaultPrevented}):!0},this._setReadyState=function(e){var r=new CustomEvent("readystatechange");r.readyState=e,this.readyState=e,this.dispatchEvent(r)},this._onStreamFailure=function(e){var r=new CustomEvent("error");r.data=e.currentTarget.response,this.dispatchEvent(r),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(e){if(this.xhr){if(this.xhr.status!==200){this._onStreamFailure(e);return}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var r=this.xhr.responseText.substring(this.progress);this.progress+=r.length,r.split(/(\r\n|\r|\n){2}/g).forEach(function(i){i.trim().length===0?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=i}.bind(this))}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||e.length===0)return null;var r={id:null,retry:null,data:"",event:"message"};e.split(/\n|\r\n|\r/).forEach(function(g){g=g.trimRight();var S=g.indexOf(this.FIELD_SEPARATOR);if(!(S<=0)){var m=g.substring(0,S);if(m in r){var o=g.substring(S+1).trimLeft();m==="data"?r[m]+=o:r[m]=o}}}.bind(this));var i=new CustomEvent(r.event);return i.data=r.data,i.id=r.id,i},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};n.SSE=s})(_e);function ue(n,s,a){const t=n.slice();return t[11]=s[a],t}function ce(n){let s,a;return s=new K({props:{type:n[11].role,message:n[11].content}}),{c(){U(s.$$.fragment)},l(t){X(s.$$.fragment,t)},m(t,e){Z(s,t,e),a=!0},p(t,e){const r={};e&8&&(r.type=t[11].role),e&8&&(r.message=t[11].content),s.$set(r)},i(t){a||(D(s.$$.fragment,t),a=!0)},o(t){M(s.$$.fragment,t),a=!1},d(t){z(s,t)}}}function fe(n){let s,a;return s=new K({props:{type:"assistant",message:n[1]}}),{c(){U(s.$$.fragment)},l(t){X(s.$$.fragment,t)},m(t,e){Z(s,t,e),a=!0},p(t,e){const r={};e&2&&(r.message=t[1]),s.$set(r)},i(t){a||(D(s.$$.fragment,t),a=!0)},o(t){M(s.$$.fragment,t),a=!1},d(t){z(s,t)}}}function de(n){let s,a;return s=new K({props:{type:"assistant",message:"Loading.."}}),{c(){U(s.$$.fragment)},l(t){X(s.$$.fragment,t)},m(t,e){Z(s,t,e),a=!0},i(t){a||(D(s.$$.fragment,t),a=!0)},o(t){M(s.$$.fragment,t),a=!1},d(t){z(s,t)}}}function ke(n){let s,a,t,e,r,i,g,S,m,o,k,L,x,E,T,c,v,N,O,$,R,Q,B,W,se;k=new K({props:{type:"assistant",message:"Hi, let's build a better backlog!"}});let G=n[3],f=[];for(let l=0;l<G.length;l+=1)f[l]=ce(ue(n,G,l));const be=l=>M(f[l],1,1,()=>{f[l]=null});let _=n[1]&&fe(n),b=n[2]&&de();return{c(){s=y("div"),a=y("div"),t=y("h1"),e=H("Tanagra"),r=P(),i=y("p"),g=H("AI powered product backlog"),S=P(),m=y("div"),o=y("div"),U(k.$$.fragment),L=P();for(let l=0;l<f.length;l+=1)f[l].c();x=P(),_&&_.c(),E=P(),b&&b.c(),T=P(),c=y("div"),v=P(),N=y("form"),O=y("input"),$=P(),R=y("button"),Q=H("Send"),this.h()},l(l){s=I(l,"DIV",{class:!0});var d=C(s);a=I(d,"DIV",{});var u=C(a);t=I(u,"H1",{class:!0});var q=C(t);e=F(q,"Tanagra"),q.forEach(w),r=A(u),i=I(u,"P",{class:!0});var ae=C(i);g=F(ae,"AI powered product backlog"),ae.forEach(w),u.forEach(w),S=A(d),m=I(d,"DIV",{class:!0});var j=C(m);o=I(j,"DIV",{class:!0});var V=C(o);X(k.$$.fragment,V),L=A(V);for(let Y=0;Y<f.length;Y+=1)f[Y].l(V);x=A(V),_&&_.l(V),E=A(V),b&&b.l(V),V.forEach(w),T=A(j),c=I(j,"DIV",{class:!0}),C(c).forEach(w),j.forEach(w),v=A(d),N=I(d,"FORM",{class:!0});var J=C(N);O=I(J,"INPUT",{type:!0,class:!0}),$=A(J),R=I(J,"BUTTON",{type:!0,class:!0});var re=C(R);Q=F(re,"Send"),re.forEach(w),J.forEach(w),d.forEach(w),this.h()},h(){p(t,"class","text-2xl font-bold w-full text-center"),p(i,"class","text-sm italic"),p(o,"class","flex flex-col gap-2"),p(c,"class",""),p(m,"class","h-[500px] w-full bg-gray-900 rounded-md p-4 overflow-y-auto flex flex-col gap-4"),p(O,"type","text"),p(O,"class","input input-bordered w-full"),p(R,"type","submit"),p(R,"class","btn btn-accent"),p(N,"class","flex w-full rounded-md gap-4 bg-gray-900 p-4"),p(s,"class","flex flex-col pt-4 w-full px-8 items-center gap-2")},m(l,d){ge(l,s,d),h(s,a),h(a,t),h(t,e),h(a,r),h(a,i),h(i,g),h(s,S),h(s,m),h(m,o),Z(k,o,null),h(o,L);for(let u=0;u<f.length;u+=1)f[u].m(o,null);h(o,x),_&&_.m(o,null),h(o,E),b&&b.m(o,null),h(m,T),h(m,c),n[6](c),h(s,v),h(s,N),h(N,O),he(O,n[0]),h(N,$),h(N,R),h(R,Q),B=!0,W||(se=[oe(O,"input",n[7]),oe(N,"submit",Ee(n[8]))],W=!0)},p(l,[d]){if(d&8){G=l[3];let u;for(u=0;u<G.length;u+=1){const q=ue(l,G,u);f[u]?(f[u].p(q,d),D(f[u],1)):(f[u]=ce(q),f[u].c(),D(f[u],1),f[u].m(o,x))}for(te(),u=G.length;u<f.length;u+=1)be(u);ee()}l[1]?_?(_.p(l,d),d&2&&D(_,1)):(_=fe(l),_.c(),D(_,1),_.m(o,E)):_&&(te(),M(_,1,1,()=>{_=null}),ee()),l[2]?b?d&4&&D(b,1):(b=de(),b.c(),D(b,1),b.m(o,null)):b&&(te(),M(b,1,1,()=>{b=null}),ee()),d&1&&O.value!==l[0]&&he(O,l[0])},i(l){if(!B){D(k.$$.fragment,l);for(let d=0;d<G.length;d+=1)D(f[d]);D(_),D(b),B=!0}},o(l){M(k.$$.fragment,l),f=f.filter(Boolean);for(let d=0;d<f.length;d+=1)M(f[d]);M(_),M(b),B=!1},d(l){l&&w(s),z(k),Se(f,l),_&&_.d(),b&&b.d(),n[6](null),W=!1,ye(se)}}}function Le(n,s,a){let t="",e="",r=!1,i=[],g;function S(){setTimeout(function(){g.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},100)}const m=async()=>{a(2,r=!0),a(3,i=[...i,{role:"user",content:t}]);const E=new _e.SSE("/api/chat",{headers:{"Content-Type":"application/json"},payload:JSON.stringify({messages:i})});a(0,t=""),E.addEventListener("error",o),E.addEventListener("message",T=>{S();try{if(a(2,r=!1),T.data==="[DONE]"){a(3,i=[...i,{role:"assistant",content:e}]),a(1,e="");return}const c=JSON.parse(T.data),[{delta:v}]=c.choices;v.content&&a(1,e=(e??"")+v.content)}catch(c){o(c)}}),E.stream(),S()};function o(E){a(2,r=!1),a(0,t=""),a(1,e=""),console.error(E)}function k(E){Ie[E?"unshift":"push"](()=>{g=E,a(4,g)})}function L(){t=this.value,a(0,t)}return[t,e,r,i,g,m,k,L,()=>m()]}class Ne extends me{constructor(s){super(),ve(this,s,Le,ke,pe,{})}}export{Ne as default};
